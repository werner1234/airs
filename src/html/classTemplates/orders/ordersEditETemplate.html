<div style="display:none;" id="uiModalDiv">
  <div id="modelContent"></div>
</div>

{addFonds}
{addNota}
{addadvise}
<div class="main_content">
  <div id="messageHolder">{AEMessage}</div>

  <form action="{updateScript}" method="POST" id="enkelvoudigForm" class="orderForm">
    <div class="form">
      <input type="hidden" name="action" value="{action}">
      <input type="hidden" name="updateScript" value="{updateScript}">
      <input type="hidden" name="return" value="{return}">
      <input type="hidden" name="redirect" value="0">
      <input type="hidden" name="zoekveld" value="">
      <input type="hidden" name="valutaKoersHidden" id="valutaKoersHidden" value="0">
      <input type="hidden" name="fondseenheidHidden" id="fondseenheidHidden" value="1">
      <input type="hidden" name="batchId" value="{batchId}" id="batchId">
      <input type="hidden" name="valuta" value="">
      <input type="hidden" name="fondsValuta" id="fondsValuta" value="{fondsValuta_value}">
      <input type="hidden" name="fonds_id" value="{fonds_id}">
      <input type="hidden" name="orderbedrag" id="orderbedrag" value="0">
      <input type="hidden" name="verzenden" id="verzenden" value="">
      <input type="hidden" value="{depotbank_value}" name="depotbank" id="Depotbank">
      <input type="hidden" value="{DepotbankOld_value}" name="DepotbankOld" id="DepotbankOld">
      <input type="hidden" value="{Risicoklasse_value}" name="Risicoklasse" id="Risicoklasse">
      <input type="hidden" name="portefeuille_id" value="">
      <input type="hidden" value="{fonds_value}" name="fonds" id="fonds">
      <input type="hidden" value="{id_value}" name="id" id="id">
      <input type="hidden" value="{orderid_value}" name="orderid" id="orderid">
      <input type="hidden" value="{orderregelId}" name="orderregelId" id="orderregelId">
      <input type="hidden" value="0" name="cancel" id="cancel">
      <input type="hidden" value="{copyFrom}" name="copyFrom" id="copyFrom">
      <input type="hidden" value="{rekeningNrTonen}" name="rekeningNrTonen" id="rekeningNrTonen">
      <input type="hidden" value="{fixTonen}" name="fixTonen" id="fixTonen">
      <input type="hidden" value="{fondseenheid_value}" name="fondseenheid" id="fondseenheid">
      <input type="hidden" value="{optieSymbool_value}" name="optieSymbool" id="optieSymbool">
      <input type="hidden" value="{optieType_value}" name="optieType" id="optieType">
      <input type="hidden" value="{optieUitoefenprijs_value}" name="optieUitoefenprijs" id="optieUitoefenprijs">
      <input type="hidden" value="{optieExpDatum_value}" name="optieExpDatum" id="optieExpDatum">
      <input type="hidden" value="{fondssoort_value}" name="fondssoort" id="fondssoort">
      <input type="hidden" value="{orderStatus_value}" name="originalOrderStatus" id="originalOrderStatus">
      <input type="hidden" value="{handmatig_uitvoeringenMuteren}" name="handmatig_uitvoeringenMuteren" id="handmatig_uitvoeringenMuteren">

      <input type="hidden" value="{fondsBankcode_value}" name="fondsBankcode" id="fondsBankcode">

      <input type="hidden" value="{fromRapport}" name="fromRapport" id="fromRapport">
      <input type="hidden" value="{adviesRelatie}" name="isAdviesRelatie" id="isAdviesRelatie">
      <input type="hidden" value="{orderredenVerplicht}" name="orderredenVerplicht" id="orderredenVerplicht">
  
      <input type="hidden" name="OrderuitvoerBewaarder" id="OrderuitvoerBewaarder" value="{OrderuitvoerBewaarder}">
      <input type="hidden" name="OrderuitvoerBewaarder_rekening_depotbank" id="OrderuitvoerBewaarder_rekening_depotbank" value="{OrderuitvoerBewaarder_rekening_depotbank}">
      <input type="hidden" name="resetControle" id="resetControle" value="0">
      
      
      <button type="button" style="margin-bottom: 5px;" tabindex="0" class="btn-new btn-blue" id='toOrderlistTop'>[vt]Terug naar overzicht[/vt]</button>
      <div id="orderSoortForm">{newOrder}</div>

      <div class="row">

        <div class="formHolder box box12">
          <div class="formTitle textB">[vt]Order[/vt] {order_identificatie}</div>
          <div class="formContent">
            <div class="padded-10">
              <table border="0" cellpadding="6" cellspacing="0">
                <tr>
                  <td><label id="PortefeuilleSelectieLabel" for="PortefeuilleSelectie">[vt]Client[/vt]</label></td>
                  <td>[vt]Portefeuille[/vt]</td>
                  <td class="fixNietNodig rekeningField">
                    <div>[vt]Rekening[/vt]</div>
                  </td>

                  <td class="fixOrderInput"><label for="fixOrder">[vt]Fix order[/vt]</label>
                  <td class="fixOrderInput careOrderInput"><label for="Care order">[vt]Care order[/vt]</label>

                  <td><label>[vt]Depotbank[/vt]</label></td>
                  <td><label>[vt]Profiel[/vt]</label></td>
                  <td>
                    <div class="fixNietNodig orderStatusField statusField">[vt]Status[/vt]</div>
                  </td>

                </tr>
                <tr>
                  <td>{PortefeuilleSelectie}<input type="hidden" name="client" id="client" value="{client_value}"></td>
                  <td>
                    <input type="text" name="portefeuille" id="portefeuille" value="{portefeuille_value}" READONLY style="background-color:#DDD">
                    {portefeuille_error}
                  </td>
                  <td class="fixNietNodig rekeningField">
                    <div>{rekening_inputfield}</div>
                  </td>

                  <td class="fixOrderInput">{fixOrder_inputfield}</td>
                  <td class="fixOrderInput careOrderInput">{careOrder_inputfield}</td>

                  <td id="depobankValue">{depobankValue}</td>
                  <td id="profileValue">{profileValue}</td>

                  <td>
                    <div class="fixNietNodig orderStatusField statusField">{orderStatus_inputfield} {orderStatus_error} {UitvoeringOngelijk}</div>
                  </td>
                </tr>
              </table>

              <table border="0" cellpadding="6" cellspacing="0" class="inline">
                <tr>
                  <td>[vt]ISIN[/vt] <span id="fonds-koers-info" class=""></span></td>
                  <td><label for="ISINCode">[vt]Fondsomschrijving[/vt]</label> <span id="fonds-info" class=""></span></td>
                  <td>[vt]Beurs[/vt]</td>
                </tr>
                <tr>
                  <td>{Fonds}
                    <div id="addNewFonds" class="input-group-addon  btn-new btn-default btn-xs">[vt]Nieuw[/vt]</div>
                  </td>
                  <td>{fondsOmschrijving_inputfield}
                    {fondsOmschrijving_error}<input type="hidden" id="fondsOmschrijvingHidden" value="{fondsOmschrijving_value}">
                  </td>
                  <td>{beurs_inputfield}</td>
                </tr>
              </table>
              <table border="0" cellpadding="6" cellspacing="0" class="inline">
                <tr>
                  <td><label class="" id="transAct" for="transactieSoort">{transactieSoort_description}</label></td>
                  <td>[vt]Aantal[/vt]</td>
                  <td><label for="transactieType">{transactieType_description}</label></td>
                </tr>
                <tr>
                  <td>{transactieSoort_inputfield} {transactieSoort_error}</td>
                  <td>{aantal_inputfield} {aantal_error}</td>
                  <td>{transactieType_inputfield} {transactieType_error}</td>
                </tr>
              </table>
            </div>
            <div class="form-actions clearB" id="saveForm">
              <span class="" id="koersInfo"></span><br>
              <span id="fondsOwnedInfo"></span><span style="margin-left: 50px;" id="BankDepotCodes"></span><br>
              <span id="orderWaarde"></span>
            </div>
          </div>
        </div>
        {orderOptionsBlock}
  </form>
</div>

<div class="form-actions clearB" id="saveForm">
  <div class="row padded-10">
    <div class="box box12">{opslaanKnop}</div>
  </div>

  <div class="row padded-10">
    <div class="box box6 fixButton">{verzendenKnop}</div>
  </div>

  <div class="row padded-10">
    <div class="box box3"><span style="margin-right:20px" class="btn-new btn-blue" id='toOrderlist'>[vt]Terug[/vt]</span> {copyOrder}</div>
    <div class="box box2">{annuleerKnop} </div>
    <span class="floatR">{formMessage}{change_user_value} {change_date_value}</span>
  </div>
</div>


<div id="orderregels"></div>
</div>


<div id="viewAdviseMailDialog" title="Basic dialog" style="display:none">
  <div class="padded-15">
    <strong>[vt]Afzender[/vt]: </strong>{adviseSenderName}<br />
    <strong>[vt]Afzender email[/vt]: </strong>{adviseSenderEmail}<br />
    <strong>[vt]Ontvanger[/vt]: </strong>{adviseReceiverName}<br />
    <strong>[vt]Ontvanger email[/vt]: </strong>{adviseReceiverEmail}<br />
    <strong>[vt]Ontvanger email Bcc[/vt]: </strong>{adviseSenderBccEmail}<br />
    <strong>[vt]Onderwerp[/vt]: </strong>{adviseSubject}<br />
    <strong>[vt]Reden[/vt]: </strong>{adviseOrderReden}<br />

    <br />
    <br />
    <strong>[vt]E-mail[/vt]</strong><br />
    <span>{adviseMail}</span>
  </div>
</div>


<div id="previewAdviseMail" title="Basic dialog" style="display:none" >
<div class="padded-15">

  <form method="post"  enctype="multipart/form-data" id="sendAdviseMailForm" action="ordersEditV2.php?action=edit&id={id_value}" >
    <input id="sendAdviceMail" type="hidden" name="sendAdviceMail" value="1"/>
    <input type="hidden" name="MAX_FILE_SIZE" value="16777216" />
    <input type="hidden" value="{orderregelId}" name="orderregelId" id="orderregelId">
    <input type="hidden" value="{orderid_value}" name="orderid" id="orderid">
    <input type="hidden" value="{adviseSubject}" name="adviseSubject" id="adviseSubject">
    <input type="hidden" value="{adviseReceiverName}" name="adviseReceiverName" id="adviseReceiverName">
    <input type="hidden" value="{adviseReceiverEmail}" name="adviseReceiverEmail" id="adviseReceiverEmail">
    <input type="hidden" value="{adviseOrderReden}" name="adviseOrderReden" id="adviseOrderReden">
    <input type="hidden" value="{adviseMailHtml}" name="adviseMail" id="adviseMail">
    <input type="hidden" name="adviseOrderOrderVerzenden" id="adviseOrderOrderVerzenden" value="">
    <input type="hidden" name="adviseOrderOrderStatus" id="adviseOrderOrderStatus" value="">
    <input type="hidden" name="return" value="{return}">

  <strong>[vt]Afzender[/vt]: </strong>{adviseSenderName}<br />
  <strong>[vt]Afzender email[/vt]: </strong>{adviseSenderEmail}<br />
  <strong>[vt]Ontvanger[/vt]: </strong>{adviseReceiverName}<br />
  <strong>[vt]Ontvanger email[/vt]: </strong>{adviseReceiverEmail}<br />
  <strong>[vt]Ontvanger email Bcc[/vt]: </strong>{adviseSenderBccEmail}<br />
  <strong>[vt]Onderwerp[/vt]: </strong>{adviseSubject}<br />
  <strong>[vt]Reden[/vt]: </strong>{adviseOrderReden}<br />

  <br />
  <br />
  <strong>[vt]E-mail[/vt]</strong><br />
  <span>{adviseMail}</span>
  <br />
  <strong>[vt]Bijlage 1[/vt]: </strong><input type="file" name="uploaded_file1"> <br />
  <strong>[vt]Bijlage 2[/vt]: </strong><input type="file" name="uploaded_file2"> <br />
  <strong>[vt]Bijlage 3[/vt]: </strong><input type="file" name="uploaded_file3"> <br />
  </form>
</div>
</div>




<script>


  function loadSendAdviseDialog() {
    var buttonsOpts = {};
    fix = '';

    // if ( 1 === 3 ) {
    //
    //   buttonsOpts['Opslaan'] = function() {
    //     $('#saveAdviceMail').val(1);
    //     $('#sendAdviceMail').val(0);
    //     $('#addAdviseForm').submit();
    //   }
    //
    //   if ($('#fixOrder').is(':checked')) {
    //     buttonsOpts['Verzenden'] = function() {
    //       $('#saveAdviceMail').val(1);
    //
    //       AEConfirm(
    //         'Wilt u de order verzenden?',
    //         'Order status',
    //         function () {
    //           $(this).dialog('destroy');
    //         },
    //         function () {
    //           $(this).dialog('destroy');
    //         }
    //       );
    //       $(this).dialog('destroy');
    //     }
    //   }
    // } else {
      buttonsOpts['Gereedmaken voor verzenden'] = function() {
        $orderRedenVal = $('.orderAdviesOrderReden select').val();
        $orderredenVerplicht = parseInt($('#orderredenVerplicht').val());

        if ( $orderredenVerplicht === 1 && $orderRedenVal.length === 0) {
          $('.orderAdviesRedenError').show();
          $('.orderAdviesOrderReden select').css('border-color', '#a94442');
        } else {
          $('#saveAdviceMail').val(1);
          $('#sendAdviceMail').val(0);
          $('#viewAdviceMail').val(1);
          $('#addAdviseForm').submit();
        }
      };
    // }
    console.log('Order advies');
    $("#dialog").dialog({
      draggable: false,
      modal: true,
      resizable: false,
      width: 'auto',
      title: 'Order advies',
      minHeight: 150,
      open: function (){
        loadEditor().done( setTimeout(
          function()
          {
            $("#dialog").dialog("option", "position", {my: "center", at: "center", of: window});
          }, 1000)
        );
      },
      buttons: buttonsOpts

    });
    console.log('Load dialog');
  };

  var loadEditor = function() {

    var r = $.Deferred();

    CKEDITOR.replace( 'emailBody' ,
      {
//            uiColor: '#9AB8F3',
        enterMode : CKEDITOR.ENTER_BR,
        allowedContent: true,
//            scayt_autoStartup:true,
//            disableNativeSpellChecker:false,
//            scayt_sLang: 'nl_NL'
      });
    console.log('Function One');

    return r;

  };



  $(function ()
  {

    $('#ignoreAdviseMailBtn').on('click', function () {

      AEConfirm(
        'Wilt u de advies mail negeren?',
        'Order advies',
        function () {
          window.location.href = "ordersEditV2.php?action=edit&id={id_value}&orderregelId={orderregelId}&ignoreAdviceMail=1";
          $(this).dialog('destroy');
        },
        function () {
          $(this).dialog('destroy');
        }
      );


    });

    //
    if ( '{viewAdviceMail}' === '1' ) {
      var buttonsOpts = {};

      if ( '{relationHasEmail}' !== '0' )
      {
        buttonsOpts['E-mail verzenden'] = function ()
        {
          $('#sendAdviseMailForm').submit();
        }
      }


      if ($('#fixOrder').is(':checked') && '{checkOrderVierOgen}' == '0' ) {
        buttonsOpts['E-mail + Order verzenden'] = function() {

          AEConfirm(
            'Wilt u de order verzenden?',
            'Order status',
            function () {
              $('#adviseOrderOrderVerzenden').val(1);
              $('#adviseOrderOrderStatus').val(1)

              $('#sendAdviceMail').val(1);
              $('#sendAdviseMailForm').submit();
              $(this).dialog('destroy');
            },
            function () {
              $(this).dialog('destroy');
            }
          );
          $(this).dialog('destroy');
        }
      }

      $("#previewAdviseMail").dialog({
        draggable: false,
        modal: true,
        resizable: false,
        title: 'Order advies',
        minHeight: 150,
        width: "90%",
        maxWidth: "768px",
        open: function (){
        },
        buttons: buttonsOpts
      });
    }


    $(document).on('click', '#viewAdviseMailBtn', function () {
      loadDialog();
    });

    $(document).on('click', '#sendAdviseMailBtn', function () {
      if ( '{viewAdviceMail}' === '1' ) {
        console.log('testtrue');
        $('#previewAdviseMail').dialog( "open" );
      } else {
        console.log('testfalse');
        loadSendAdviseDialog();
      }
    });

    var loadDialog = function() {
      $("#viewAdviseMailDialog").dialog({
        draggable: false,
        modal: true,
        resizable: false,
        width: 'auto',
        title: 'Order advies',
        minHeight: 150,
        open: function (){
        },
        buttons: {
          "Sluiten": function ()
          {

            $(this).dialog('destroy');
          }
        }
      });
    };


    $('#dialog').hide();



    function clearCustomData() {

    }





  });
</script>